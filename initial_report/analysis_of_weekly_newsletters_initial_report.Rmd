---
title: "Analysis of Weekly Newsletters: Initial Report"
output: pdf_document
---

# Executive Summary

## Questions of Interest

* What are some general trends regarding the weekly newsletters' metrics (open, click, bounce and unsubscribe rates)? 

## Statistical Analysis

* Correlations between the metrics
* Scatterplots of the metrics vs. various factors

## Takeaways

* Clicks are positively correlated with opens, but negatively correlated with unsubscribes.
* The start of the COVID pandemic seemed to have caused a temporary spike in engagement.
* The next two reports, "Trends in the Open Probability" and "Trends in the Click Probability," will delve further into how various factors affect the open and click rate. 



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
```

```{r}
library(ggplot2)
library(scales)
library(lubridate)
library(GGally)
library(here)
library(knitr)

i_am("initial_report/analysis_of_weekly_newsletters_initial_report.Rmd")
```

```{r}
load(here("initial_report", "weeklies1.RData"))
```

# Overview of the Data Used

We focus on 54 newsletters, sent roughly weekly in the years 2019 and 2020. For this initial report, we look at four aggregated metrics for the newsletters: the open, click, bounce, and unsubscribe percentages.  

The definition of the metrics are as follows:

$$\mathrm{Open \ \%} = \frac{\mathrm{number \ of \ contacts \ who \ opened \ the \ newsletter}}{\mathrm{number \ of \ contacts \ sent \ to}} \times 100\%$$

$$\mathrm{Click \ \%} = \frac{\mathrm{number \ of \ contacts \ who \ clicked \ a \ link \ in \ the \ newsletter}}{\mathrm{number \ of \ contacts \ sent \ to}} \times 100\%$$

$$\mathrm{Bounce \ \%} = \frac{\mathrm{number \ of \ contacts \ who \ could \ not \ be \ reached}}{\mathrm{number \ of \ contacts \ sent \ to}} \times 100\%$$

$$\mathrm{Unsubscribe \ \%} = \frac{\mathrm{number \ of \ contacts \ who \ used \ newsletter \ to \ unsubscribe}}{\mathrm{number \ of \ contacts \ sent \ to}} \times 100\%$$

We also examine the following characteristics of the newsletters:

* Trend over the date newsletter was sent out (2019-01-01 to 2020-12-31).
* Whether newsletter was sent before or after start of the COVID pandemic on 2020-03-12.
* Time of day newsletter was sent out (6:30 am to 8:40 pm).
* Length of subject by number of characters.

Below are 5 example newsletters from the dataset, i.e. the 5th, 8th, 25th, 35th, and 47th newsletters sent out.

```{r}
sample_idx <- c(5, 8, 25, 35, 47)

kable(subset(weeklies1, select = c("datetime", "opened", "clicks", "bounces", "unsubscribes"))[sample_idx,],
      row.names = TRUE)

kable(subset(weeklies1, select = c("contacts_sent_to", "covid", "mins_since_midnight", "subject_length"))[sample_idx,],
      row.names = TRUE)
```



# Correlation of the Metrics

```{r}
metrics <- weeklies1[, names(weeklies1) %in% c("opened", "clicks", "bounces", "unsubscribes")]
```

```{r}
ggpairs(metrics, title = "Correlogram of the Metrics")
```

There are two significant correlations: a positive one between opens and clicks, and a negative one between unsubscribes and clicks. 



# Summary Statistics over Time, 2019-2020

```{r}
ggplot(data = weeklies1, aes(x = datetime, y = contacts_sent_to)) + 
  geom_point() + 
  ggtitle("Number of Contacts Sent To over Time, 2019-2020") + 
  xlab("Month/Year") +
  ylab("Number of Contacts Sent To") +
  geom_smooth() +
  scale_x_datetime(labels = date_format("%m/%y"), 
               breaks = date_breaks("2 month"))
  
```

When did the pandemic start changing things? The March 12 weekly newsletter was the first one to mention the COVID-19 pandemic and remote volunteering opportunities. 

```{r}
ggplot(data = weeklies1, aes(x = datetime, y = opened, col = covid)) + 
  geom_point() + 
  ggtitle("Open % over Time, 2019-2020") + 
  xlab("Month/Year") +
  ylab("Open %") +
  geom_smooth() +
  scale_x_datetime(labels = date_format("%m/%y"), 
               breaks = date_breaks("2 month")) + 
  geom_vline(xintercept = as.POSIXct("2020-03-01"), col = "red")
  
```

There is a spike in the open % after March. 



```{r}
ggplot(data = weeklies1, aes(x = datetime, y = clicks, col = covid)) + 
  geom_point() + 
  ggtitle("Click % over Time, 2019-2020") + 
  xlab("Month/Year") +
  ylab("Click %") +
  geom_smooth() +
  scale_x_datetime(labels = date_format("%m/%y"), 
               breaks = date_breaks("2 month")) + 
  geom_vline(xintercept = as.POSIXct("2020-03-01"), col = "red")
```



```{r}
ggplot(data = weeklies1, aes(x = datetime, y = unsubscribes, col = covid)) + 
  geom_point() + 
  ggtitle("Unsubscribe % over Time, 2019-2020") + 
  xlab("Month/Year") +
  ylab("Unsubscribe %") +
  geom_smooth() +
  scale_x_datetime(labels = date_format("%m/%y"), 
               breaks = date_breaks("2 month")) + 
  geom_vline(xintercept = as.POSIXct("2020-03-01"), col = "red")
```



<!-- # Summary Statistics by Season -->

<!-- ```{r} -->
<!-- ggplot(data = weeklies1[weeklies1$covid == "Before",], aes(season, opened)) +  -->
<!--   geom_boxplot() -->
<!-- ``` -->

<!-- ```{r} -->
<!-- ggplot(data = weeklies1[weeklies1$covid == "After",], aes(season, opened)) +  -->
<!--   geom_boxplot() -->
<!-- ``` -->



# Summary Statistics throughout a Day

```{r}
# extracting the time
# this sets all the dates to 2021-01-10
daytime <- as.POSIXct(format(weeklies1$datetime, format="%H:%M"),
                    tz = "America/New_York", format = "%H:%M")
```

```{r}
weeklies_before <- weeklies1[weeklies1$covid == "Before",]
weeklies_after <- weeklies1[weeklies1$covid == "After",]
```

<!-- ```{r} -->
<!-- ggplot(data = weeklies_after, aes(x = mins_since_midnight, y = opened)) +  -->
<!--   geom_point() +  -->
<!--   ggtitle("Open % throughout a Day") +  -->
<!--   xlab("Time") + -->
<!--   ylab("Open %") + -->
<!--   geom_smooth() #+ -->
<!--   #scale_x_datetime(labels = date_format("%m/%y"),  -->
<!--                #breaks = date_breaks("2 month")) -->
<!-- ``` -->

```{r}
ggplot(data = weeklies1, aes(x = daytime, y = opened, col = covid)) + 
  geom_point() + 
  ggtitle("Open % throughout a Day") + 
  xlab("Time") +
  ylab("Open %") +
  geom_smooth(aes(group = 1)) # +
  # scale_x_datetime(breaks = date_breaks("1 hour"), labels = date_format("%H:%M"))
```

There may be a slight upward trend. 



# Effect of Subject Headings

<!-- Summary Statistics for number of characters within subject heading -->

<!-- ```{r} -->
<!-- summary(weeklies1$subject_length) -->
<!-- ``` -->

```{r}
ggplot(data = weeklies1, aes(x = subject_length, y = opened, col = covid)) + 
  geom_point() + 
  ggtitle("Open % by Subject Length") + 
  xlab("Subject Length in characters") +
  ylab("Open %") +
  geom_smooth(aes(group = 1))
```

<!-- ```{r} -->
<!-- ggplot(data = weeklies1, aes(x = subject_num_words, y = opened)) +  -->
<!--   geom_point() +  -->
<!--   ggtitle("Open % by Number of Words in Subject") +  -->
<!--   xlab("Number of Words in Subject") + -->
<!--   ylab("Open %") -->
<!-- ``` -->



<!-- # Modeling -->

<!-- ```{r} -->
<!-- weeklies1$covid <- factor(weeklies1$covid, levels = c("Before", "After")) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- opens_lm <- lm(opened ~ datetime*covid + mins_since_midnight + subject_length, data = weeklies1) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- summary(opens_lm) -->
<!-- ``` -->



<!-- Repeat for monthly donor newsletters -->




